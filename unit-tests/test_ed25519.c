#include <stdarg.h>
#include <stddef.h>
#include <setjmp.h>
#include <stdint.h>
#include <stdbool.h>
#include <string.h>

#include <cmocka.h>

#include "sodium/keypair.h"

static void test_ed25519_pk_to_curve25519(void** state) {
    (void)state;

    int ret = -1;
    const unsigned char ed25519_pk[] = {0x94, 0x1d, 0xa0, 0x9e, 0x88, 0x7f, 0x1f, 0x45, 0x9c, 0xee, 0xc5, 0xa6, 0xe6, 0x91, 0x4d, 0xb5, 0xb9, 0x5f, 0x00,
                                        0x3d, 0xbf, 0xa8, 0x1c, 0xca, 0x11, 0xf3, 0x6c, 0x6b, 0x89, 0xdd, 0x58, 0xbc};
    const unsigned char expected_curve25519_pk[] = {0x5c, 0xb1, 0x49, 0x3b, 0xfe, 0xbe, 0xae, 0x82, 0xdc, 0xb7, 0xec, 0x7a, 0x24, 0xbf, 0xe4, 0x27, 0xea, 0x40, 0xef,
                                                    0x86, 0xdc, 0x64, 0x5a, 0x2e, 0x48, 0x01, 0x0e, 0xa5, 0x54, 0x92, 0x88, 0x12};
    unsigned char output[32] = {0};

    ret = ed25519_pk_to_curve25519(output, ed25519_pk);
    assert_int_equal(ret, 0);
    assert_memory_equal(output, expected_curve25519_pk, sizeof(output));
}

int main() {
    const struct CMUnitTest tests[] = {cmocka_unit_test(test_ed25519_pk_to_curve25519)};

    return cmocka_run_group_tests(tests, NULL, NULL);
}
